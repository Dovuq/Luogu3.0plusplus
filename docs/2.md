源链接<https://www.luogu.com.cn/paste/mjlhw7hj>

# Luogu 3.0+++ 语言用户手册（下）——扩展状态类型集

**Luogu 3.0+++** 语言是 [Luogu 3.0++](https://www.luogu.com.cn/paste/mmuza7hy) 扩充了状态类型的版本。

如果未特殊说明，栈内元素的运算默认对 $p$ 取模，其中 $p = 998244353 = 119 \times 2^{23} + 1$。

## 扩展状态类型

令状态数量为 $n$，所有状态依次编号为 $1 \sim n$。

状态数量最多不能超过 ${10}^5$ 个，如果多于这个值，则会得到 **`TOO_MANY_STATES`** 的编译错误提示信息。

Luogu 3.0+++ 添加了如下这些新状态类型，它们用于实现一些对栈中一个范围内的元素的运算（包括类似现代处理器架构的向量并行操作等）：

| 类型 | 格式与参数 | 具体描述 | 额外参数限制 |
|:-:|:-:|:-:|:-:|
| 前缀和 | `T00 X1 Q1` | 令栈 `X1` 的栈顶元素为 $k$，自栈顶至栈底的 $k + 1$ 个元素依次为 $k, a_1, a_2, \ldots , a_k$，令 $b_i = \sum_{j = 1}^{i} a_j$（$1 \le i \le k$），对栈 `X1` 进行 $k + 1$ 次出栈操作，然后对栈 `X1` 进行 $k + 1$ 次入栈操作，依次推入值 $b_k, b_{k - 1}, \ldots , b_1, k$，然后转移到状态 `Q1` | 如果栈 `X1` 为空栈或长度不足 $k + 1$ 或 $k > {10}^4$，可能会得到 **`UNDEFINED_BEHAVIOR`** 的运行时错误提示信息 |
| 后缀和 | `T01 X1 Q1` | 令栈 `X1` 的栈顶元素为 $k$，自栈顶至栈底的 $k + 1$ 个元素依次为 $k, a_1, a_2, \ldots , a_k$，令 $b_i = \sum_{j = i}^{k} a_j$（$1 \le i \le k$），对栈 `X1` 进行 $k + 1$ 次出栈操作，然后对栈 `X1` 进行 $k + 1$ 次入栈操作，依次推入值 $b_k, b_{k - 1}, \ldots , b_1, k$，然后转移到状态 `Q1` | 如果栈 `X1` 为空栈或长度不足 $k + 1$ 或 $k > {10}^4$，可能会得到 **`UNDEFINED_BEHAVIOR`** 的运行时错误提示信息 |
| 差分 | `T02 X1 Q1` | 令栈 `X1` 的栈顶元素为 $k$，自栈顶至栈底的 $k + 1$ 个元素依次为 $k, a_1, a_2, \ldots , a_k$，特别地，令 $a_0 = 0$，令 $b_i = a_i - a_{i - 1}$（$1 \le i \le k$），对栈 `X1` 进行 $k + 1$ 次出栈操作，然后对栈 `X1` 进行 $k + 1$ 次入栈操作，依次推入值 $b_k, b_{k - 1}, \ldots , b_1, k$，然后转移到状态 `Q1` | 如果栈 `X1` 为空栈或长度不足 $k + 1$ 或 $k > {10}^4$，可能会得到 **`UNDEFINED_BEHAVIOR`** 的运行时错误提示信息 |
| 反转 | `T03 X1 Q1` | 令栈 `X1` 的栈顶元素为 $k$，自栈顶至栈底的 $k + 1$ 个元素依次为 $k, a_1, a_2, \ldots , a_k$，对栈 `X1` 进行 $k + 1$ 次出栈操作，然后对栈 `X1` 进行 $k + 1$ 次入栈操作，依次推入值 $a_1, a_2, \ldots , a_k, k$，然后转移到状态 `Q1` | 如果栈 `X1` 为空栈或长度不足 $k + 1$ 或 $k > {10}^4$，可能会得到 **`UNDEFINED_BEHAVIOR`** 的运行时错误提示信息 |
| 排序 | `T04 X1 Q1` | 令栈 `X1` 的栈顶元素为 $k$，自栈顶至栈底的 $k + 1$ 个元素依次为 $k, a_1, a_2, \ldots , a_k$，令 $b_i = a_i$（$1 \le i \le k$），然后对 $b_1 \sim b_k$ **从小到大排序**，对栈 `X1` 进行 $k + 1$ 次出栈操作，然后对栈 `X1` 进行 $k + 1$ 次入栈操作，依次推入值 $b_k, b_{k - 1}, \ldots , b_1, k$，然后转移到状态 `Q1` | 如果栈 `X1` 为空栈或长度不足 $k + 1$ 或 $k > {10}^4$，可能会得到 **`UNDEFINED_BEHAVIOR`** 的运行时错误提示信息 |
| 反向排序 | `T05 X1 Q1` | 令栈 `X1` 的栈顶元素为 $k$，自栈顶至栈底的 $k + 1$ 个元素依次为 $k, a_1, a_2, \ldots , a_k$，令 $b_i = a_i$（$1 \le i \le k$），然后对 $b_1 \sim b_k$ **从大到小排序**，对栈 `X1` 进行 $k + 1$ 次出栈操作，然后对栈 `X1` 进行 $k + 1$ 次入栈操作，依次推入值 $b_k, b_{k - 1}, \ldots , b_1, k$，然后转移到状态 `Q1` | 如果栈 `X1` 为空栈或长度不足 $k + 1$ 或 $k > {10}^4$，可能会得到 **`UNDEFINED_BEHAVIOR`** 的运行时错误提示信息 |
| 旋转 | `T06 X1 X2 Q1` | 令栈 `X1` 的栈顶元素为 $k$，自栈顶至栈底的 $k + 1$ 个元素依次为 $k, a_1, a_2, \ldots , a_k$，令栈 `X2` 的栈顶元素为 $q$，对栈 `X1` 进行 $k + 1$ 次出栈操作，然后对栈 `X1` 进行 $k + 1$ 次入栈操作，前 $q$ 次中的第 $i$ 次推入值 $a_{q - i + 1}$，接下来 $k - q$ 次中的第 $i$ 次推入值 $a_{k - i + 1}$，最后一次推入值 $k$，然后转移到状态 `Q1` | 如果栈 `X1` 为空栈或长度不足 $k + 1$ 或 $k > {10}^4$，或栈 `X2` 为空栈，或 $q \ge k$，可能会得到 **`UNDEFINED_BEHAVIOR`** 的运行时错误提示信息 |
| 批量移动 | `T07 X1 X2 Q1` | 令栈 `X2` 的栈顶元素为 $k$，自栈顶至栈底的 $k + 1$ 个元素依次为 $k, a_1, a_2, \ldots , a_k$，对栈 `X2` 进行 $k + 1$ 次出栈操作，然后对栈 `X1` 进行 $k + 1$ 次入栈操作，依次推入值 $a_k, a_{k - 1}, \ldots , a_1, k$，然后转移到状态 `Q1` | 如果栈 `X2` 为空栈或长度不足 $k + 1$ 或 $k > {10}^4$，可能会得到 **`UNDEFINED_BEHAVIOR`** 的运行时错误提示信息 |
| 批量复制 | `T08 X1 X2 Q1` | 令栈 `X2` 的栈顶元素为 $k$，自栈顶至栈底的 $k + 1$ 个元素依次为 $k, a_1, a_2, \ldots , a_k$，对栈 `X1` 进行 $k + 1$ 次入栈操作，依次推入值 $a_k, a_{k - 1}, \ldots , a_1, k$，然后转移到状态 `Q1` | 如果栈 `X2` 为空栈或长度不足 $k + 1$ 或 $k > {10}^4$，可能会得到 **`UNDEFINED_BEHAVIOR`** 的运行时错误提示信息 |
| 填充 | `T09 X1 X2 Q1` | 令栈 `X1` 的栈顶元素为 $k$，令栈 `X2` 的栈顶元素为 $v$，对栈 `X1` 进行出栈操作，然后对栈 `X1` 进行 $k + 1$ 次入栈操作，前 $k$ 次推入值 $v$，最后一次推入值 $k$，然后转移到状态 `Q1` | 如果栈 `X1` 为空栈或 $k > {10}^4$，或栈 `X2` 为空栈，可能会得到 **`UNDEFINED_BEHAVIOR`** 的运行时错误提示信息 |
| ι | `T10 X1 X2 Q1` | 令栈 `X1` 的栈顶元素为 $k$，令栈 `X2` 的栈顶元素为 $v$，对栈 `X1` 进行出栈操作，然后对栈 `X1` 进行 $k + 1$ 次入栈操作，前 $k$ 次中的第 $i$ 次推入值 $v + k - i$，最后一次推入值 $k$，然后转移到状态 `Q1` | 如果栈 `X1` 为空栈或 $k > {10}^4$，或栈 `X2` 为空栈，可能会得到 **`UNDEFINED_BEHAVIOR`** 的运行时错误提示信息 |
| 求和 | `T11 X1 X2 Q1` | 令栈 `X2` 的栈顶元素为 $k$，自栈顶至栈底的 $k + 1$ 个元素依次为 $k, a_1, a_2, \ldots , a_k$，对栈 `X1` 进行入栈操作，推入值 $\sum_{i = 1}^{k} a_i$，然后转移到状态 `Q1` | 如果栈 `X2` 为空栈或长度不足 $k + 1$ 或 $k > {10}^4$，可能会得到 **`UNDEFINED_BEHAVIOR`** 的运行时错误提示信息 |
| 求积 | `T12 X1 X2 Q1` | 令栈 `X2` 的栈顶元素为 $k$，自栈顶至栈底的 $k + 1$ 个元素依次为 $k, a_1, a_2, \ldots , a_k$，对栈 `X1` 进行入栈操作，推入值 $\prod_{i = 1}^{k} a_i$，然后转移到状态 `Q1` | 如果栈 `X2` 为空栈或长度不足 $k + 1$ 或 $k > {10}^4$，可能会得到 **`UNDEFINED_BEHAVIOR`** 的运行时错误提示信息 |
|  |  |  |  |
| 批量加法 | `T14 X1 X2 Q1` | 令栈 `X1` 的栈顶元素为 $k$，自栈顶至栈底的 $k + 1$ 个元素依次为 $k, a_1, a_2, \ldots , a_k$，令栈 `X2` 的栈顶元素为 $x$，令 $b_i = a_i + x$（$1 \le i \le k$），对栈 `X1` 进行 $k + 1$ 次出栈操作，然后对栈 `X1` 进行 $k + 1$ 次入栈操作，依次推入值 $b_k, b_{k - 1}, \ldots , b_1, k$，然后转移到状态 `Q1` | 如果栈 `X1` 为空栈或长度不足 $k + 1$ 或 $k > {10}^4$，或栈 `X2` 为空栈，可能会得到 **`UNDEFINED_BEHAVIOR`** 的运行时错误提示信息 |
| 批量减法 | `T15 X1 X2 Q1` | 令栈 `X1` 的栈顶元素为 $k$，自栈顶至栈底的 $k + 1$ 个元素依次为 $k, a_1, a_2, \ldots , a_k$，令栈 `X2` 的栈顶元素为 $x$，令 $b_i = a_i - x$（$1 \le i \le k$），对栈 `X1` 进行 $k + 1$ 次出栈操作，然后对栈 `X1` 进行 $k + 1$ 次入栈操作，依次推入值 $b_k, b_{k - 1}, \ldots , b_1, k$，然后转移到状态 `Q1` | 如果栈 `X1` 为空栈或长度不足 $k + 1$ 或 $k > {10}^4$，或栈 `X2` 为空栈，可能会得到 **`UNDEFINED_BEHAVIOR`** 的运行时错误提示信息 |
| 批量乘法 | `T16 X1 X2 Q1` | 令栈 `X1` 的栈顶元素为 $k$，自栈顶至栈底的 $k + 1$ 个元素依次为 $k, a_1, a_2, \ldots , a_k$，令栈 `X2` 的栈顶元素为 $x$，令 $b_i = a_i \cdot x$（$1 \le i \le k$），对栈 `X1` 进行 $k + 1$ 次出栈操作，然后对栈 `X1` 进行 $k + 1$ 次入栈操作，依次推入值 $b_k, b_{k - 1}, \ldots , b_1, k$，然后转移到状态 `Q1` | 如果栈 `X1` 为空栈或长度不足 $k + 1$ 或 $k > {10}^4$，或栈 `X2` 为空栈，可能会得到 **`UNDEFINED_BEHAVIOR`** 的运行时错误提示信息 |
| 批量整数除法 | `T17 X1 X2 Q1` | 令栈 `X1` 的栈顶元素为 $k$，自栈顶至栈底的 $k + 1$ 个元素依次为 $k, a_1, a_2, \ldots , a_k$，令栈 `X2` 的栈顶元素为 $x$，令 $b_i = \left\lfloor \frac{a_i}{x} \right\rfloor$（$1 \le i \le k$），对栈 `X1` 进行 $k + 1$ 次出栈操作，然后对栈 `X1` 进行 $k + 1$ 次入栈操作，依次推入值 $b_k, b_{k - 1}, \ldots , b_1, k$，然后转移到状态 `Q1` | 如果栈 `X1` 为空栈或长度不足 $k + 1$ 或 $k > {10}^4$，或栈 `X2` 为空栈，或栈 `X2` 的栈顶元素为 $0$，可能会得到 **`UNDEFINED_BEHAVIOR`** 的运行时错误提示信息 |
| 批量整数取模 | `T18 X1 X2 Q1` | 令栈 `X1` 的栈顶元素为 $k$，自栈顶至栈底的 $k + 1$ 个元素依次为 $k, a_1, a_2, \ldots , a_k$，令栈 `X2` 的栈顶元素为 $x$，令 $b_i = a_i \bmod x$（$1 \le i \le k$），对栈 `X1` 进行 $k + 1$ 次出栈操作，然后对栈 `X1` 进行 $k + 1$ 次入栈操作，依次推入值 $b_k, b_{k - 1}, \ldots , b_1, k$，然后转移到状态 `Q1` | 如果栈 `X1` 为空栈或长度不足 $k + 1$ 或 $k > {10}^4$，或栈 `X2` 为空栈，或栈 `X2` 的栈顶元素为 $0$，可能会得到 **`UNDEFINED_BEHAVIOR`** 的运行时错误提示信息 |
| 向量加法 | `T19 X1 X2 X3 Q1` | 令栈 `X1` 的栈顶元素为 $k$，令栈 `X2` 自栈顶至栈底的 $k$ 个元素依次为 $a_1, a_2, \ldots , a_k$，令栈 `X3` 自栈顶至栈底的 $k$ 个元素依次为 $b_1, b_2, \ldots , b_k$，令 $c_i = a_i + b_i$（$1 \le i \le k$），对栈 `X1` 进行出栈操作，然后对栈 `X1` 进行 $k + 1$ 次入栈操作，依次推入值 $c_k, c_{k - 1}, \ldots , c_1, k$，然后转移到状态 `Q1` | 如果栈 `X1` 为空栈或 $k > {10}^4$，或栈 `X2` 长度不足 $k$，或栈 `X3` 长度不足 $k$，可能会得到 **`UNDEFINED_BEHAVIOR`** 的运行时错误提示信息 |
| 向量减法 | `T20 X1 X2 X3 Q1` | 令栈 `X1` 的栈顶元素为 $k$，令栈 `X2` 自栈顶至栈底的 $k$ 个元素依次为 $a_1, a_2, \ldots , a_k$，令栈 `X3` 自栈顶至栈底的 $k$ 个元素依次为 $b_1, b_2, \ldots , b_k$，令 $c_i = a_i - b_i$（$1 \le i \le k$），对栈 `X1` 进行出栈操作，然后对栈 `X1` 进行 $k + 1$ 次入栈操作，依次推入值 $c_k, c_{k - 1}, \ldots , c_1, k$，然后转移到状态 `Q1` | 如果栈 `X1` 为空栈或 $k > {10}^4$，或栈 `X2` 长度不足 $k$，或栈 `X3` 长度不足 $k$，可能会得到 **`UNDEFINED_BEHAVIOR`** 的运行时错误提示信息 |
| 向量乘法 | `T21 X1 X2 X3 Q1` | 令栈 `X1` 的栈顶元素为 $k$，令栈 `X2` 自栈顶至栈底的 $k$ 个元素依次为 $a_1, a_2, \ldots , a_k$，令栈 `X3` 自栈顶至栈底的 $k$ 个元素依次为 $b_1, b_2, \ldots , b_k$，令 $c_i = a_i \cdot b_i$（$1 \le i \le k$），对栈 `X1` 进行出栈操作，然后对栈 `X1` 进行 $k + 1$ 次入栈操作，依次推入值 $c_k, c_{k - 1}, \ldots , c_1, k$，然后转移到状态 `Q1` | 如果栈 `X1` 为空栈或 $k > {10}^4$，或栈 `X2` 长度不足 $k$，或栈 `X3` 长度不足 $k$，可能会得到 **`UNDEFINED_BEHAVIOR`** 的运行时错误提示信息 |

由于技术原因，并没有实现向量整数除法和向量整数取模的状态类型。

[`T13 X1 Q1`]: **具体描述**：令栈`X1`的栈顶元素为$k$，自栈顶至栈底的$k+1$个元素依次为$k,a_1,a_2,\ldots,a_k$，令$\displaystyle{}b_{i+1}=\sum_{j=0}^{k-1}a_{j+1}\cdot{}{\left({114514}^{(p-1)/k}\right)}^{ij}$（$0\le{}i<k$），对栈`X1`进行$k+1$次出栈操作，然后对栈`X1`进行$k+1$次入栈操作，依次推入值$b_k,b_{k-1},\ldots,b_1,k$，然后转移到状态`Q1`。**额外参数限制**：如果栈`X1`为空栈或长度不足$k+1$或$k=0$或$k>{10}^4$或$\log_2{k}$不为整数，可能会得到`UNDEFINED_BEHAVIOR`的运行时错误提示信息。

未特殊说明时：上表中的参数 `X1`、`X2` 和 `X3` 仅能取字符 `A`、`B` 或 `C` 之一，表示对应栈的编号；参数 `Q1` 仅能取 $1 \sim n$ 之间的整数，表示对应状态的编号。

上表中的一些 LaTeX 公式或其他内容可能在部分平台上无法正常显示，读者可以在兼容性更好的软件上查看。

**需要注意的是**：这些状态类型对计数器的影响，与基础语法中的不同，不是令 $c \gets c + 1$，而是令 $c \gets c + {10}^4$，也就是说这些状态类型在程序运行中不能被经过超过 $100$ 次。
